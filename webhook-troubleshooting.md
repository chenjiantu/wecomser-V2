# ğŸ”§ Webhooké—®é¢˜æ’æŸ¥æŒ‡å—

## é—®é¢˜æè¿°
ä¼ä¸šå¾®ä¿¡webhookæ— æ³•æ­£å¸¸æ¥æ”¶è¡¨å•æäº¤çš„å’¨è¯¢ä¿¡æ¯ã€‚

## ğŸš¨ å¯èƒ½çš„åŸå› 

### 1. CORSè·¨åŸŸé—®é¢˜ â­ **æœ€å¯èƒ½çš„åŸå› **
- **é—®é¢˜**ï¼šæµè§ˆå™¨çš„åŒæºç­–ç•¥é˜»æ­¢ç›´æ¥ä»å‰ç«¯è°ƒç”¨ä¼ä¸šå¾®ä¿¡API
- **è¡¨ç°**ï¼šæ§åˆ¶å°å‡ºç°CORSé”™è¯¯ï¼Œæˆ–è€…`Failed to fetch`é”™è¯¯
- **è§£å†³æ–¹æ¡ˆ**ï¼š
  - ä½¿ç”¨ä»£ç†æœåŠ¡å™¨è½¬å‘è¯·æ±‚
  - éƒ¨ç½²åç«¯APIä½œä¸ºä¸­ä»‹
  - ä½¿ç”¨æœåŠ¡ç«¯æ¸²æŸ“

### 2. Webhook Keyå¤±æ•ˆ
- **é—®é¢˜**ï¼šä¼ä¸šå¾®ä¿¡ç¾¤èŠæœºå™¨äººçš„webhook keyå·²è¿‡æœŸæˆ–è¢«é‡ç½®
- **è¡¨ç°**ï¼šHTTP 400/401é”™è¯¯
- **è§£å†³æ–¹æ¡ˆ**ï¼š
  1. è¿›å…¥ä¼ä¸šå¾®ä¿¡ç¾¤èŠ
  2. ç‚¹å‡»ç¾¤è®¾ç½® â†’ ç¾¤æœºå™¨äºº
  3. é‡æ–°ç”Ÿæˆwebhookåœ°å€
  4. æ›´æ–°ä»£ç ä¸­çš„webhook URL

### 3. ç½‘ç»œè¿æ¥é—®é¢˜
- **é—®é¢˜**ï¼šç½‘ç»œç¯å¢ƒæ— æ³•è®¿é—®ä¼ä¸šå¾®ä¿¡æœåŠ¡å™¨
- **è¡¨ç°**ï¼šè¯·æ±‚è¶…æ—¶æˆ–ç½‘ç»œé”™è¯¯
- **è§£å†³æ–¹æ¡ˆ**ï¼š
  - æ£€æŸ¥ç½‘ç»œè¿æ¥
  - å°è¯•ä½¿ç”¨VPN
  - æ£€æŸ¥é˜²ç«å¢™è®¾ç½®

### 4. è¯·æ±‚æ ¼å¼é”™è¯¯
- **é—®é¢˜**ï¼šå‘é€çš„æ¶ˆæ¯æ ¼å¼ä¸ç¬¦åˆä¼ä¸šå¾®ä¿¡APIè¦æ±‚
- **è¡¨ç°**ï¼šHTTP 400é”™è¯¯
- **è§£å†³æ–¹æ¡ˆ**ï¼šæ£€æŸ¥æ¶ˆæ¯æ ¼å¼æ˜¯å¦æ­£ç¡®

## ğŸ› ï¸ å·²å®æ–½çš„ä¿®å¤

### 1. å¢å¼ºé”™è¯¯å¤„ç†
- æ·»åŠ è¯¦ç»†çš„é”™è¯¯æ—¥å¿—è¾“å‡º
- åŒºåˆ†ä¸åŒç±»å‹çš„é”™è¯¯ï¼ˆCORSã€è¶…æ—¶ã€ç½‘ç»œç­‰ï¼‰
- æä¾›æ›´å‹å¥½çš„ç”¨æˆ·æç¤ºä¿¡æ¯

### 2. é‡è¯•æœºåˆ¶
- è‡ªåŠ¨é‡è¯•å¤±è´¥çš„è¯·æ±‚ï¼ˆæœ€å¤šé‡è¯•2æ¬¡ï¼‰
- æŒ‡æ•°é€€é¿ç­–ç•¥ï¼ˆ1ç§’ã€2ç§’é—´éš”ï¼‰
- è¯·æ±‚è¶…æ—¶æ§åˆ¶ï¼ˆ10ç§’ï¼‰

### 3. å¤‡ç”¨è”ç³»æ–¹å¼
- Webhookå¤±è´¥æ—¶è‡ªåŠ¨æ˜¾ç¤ºè”ç³»æ–¹å¼å¼¹çª—
- åŒ…å«å¾®ä¿¡ã€ç”µè¯ã€é‚®ç®±ç­‰å¤šç§è”ç³»æ–¹å¼
- ç¡®ä¿ç”¨æˆ·èƒ½å¤Ÿé€šè¿‡å…¶ä»–æ–¹å¼è”ç³»

### 4. è°ƒè¯•å·¥å…·
- æ·»åŠ `testWebhook()`å‡½æ•°ï¼Œå¯åœ¨æ§åˆ¶å°æµ‹è¯•è¿æ¥
- è¯¦ç»†çš„æ§åˆ¶å°æ—¥å¿—è¾“å‡º
- é…ç½®åŒ–çš„webhookè®¾ç½®

## ğŸ” è°ƒè¯•æ­¥éª¤

### 1. æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·
æŒ‰F12æ‰“å¼€æ§åˆ¶å°ï¼ŒæŸ¥çœ‹é”™è¯¯ä¿¡æ¯

### 2. æµ‹è¯•webhookè¿æ¥
åœ¨æ§åˆ¶å°è¾“å…¥ï¼š
```javascript
testWebhook()
```

### 3. æŸ¥çœ‹é”™è¯¯ç±»å‹
- **CORSé”™è¯¯**ï¼š`Access to fetch at 'https://qyapi.weixin.qq.com' from origin 'null' has been blocked by CORS policy`
- **ç½‘ç»œé”™è¯¯**ï¼š`Failed to fetch` æˆ– `net::ERR_NETWORK_CHANGED`
- **è¶…æ—¶é”™è¯¯**ï¼š`The operation was aborted`
- **APIé”™è¯¯**ï¼šHTTPçŠ¶æ€ç 400ã€401ã€500ç­‰

## ğŸ’¡ æ¨èè§£å†³æ–¹æ¡ˆ

### æ–¹æ¡ˆ1ï¼šä½¿ç”¨ä»£ç†æœåŠ¡å™¨ï¼ˆæ¨èï¼‰
åˆ›å»ºä¸€ä¸ªç®€å•çš„åç«¯APIä½œä¸ºä»£ç†ï¼š

```javascript
// åç«¯ä»£ç†ç¤ºä¾‹ï¼ˆNode.js + Expressï¼‰
app.post('/api/webhook', async (req, res) => {
  try {
    const response = await fetch(WEBHOOK_URL, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(req.body)
    });
    const result = await response.json();
    res.json(result);
  } catch (error) {
    res.status(500).json({ error: error.message });
  }
});
```

### æ–¹æ¡ˆ2ï¼šæ›´æ–°Webhook Key
1. è¿›å…¥ä¼ä¸šå¾®ä¿¡ç¾¤èŠ
2. ç¾¤è®¾ç½® â†’ ç¾¤æœºå™¨äºº â†’ æ·»åŠ æœºå™¨äºº
3. é€‰æ‹©"è‡ªå®šä¹‰æœºå™¨äºº"
4. å¤åˆ¶æ–°çš„webhookåœ°å€
5. æ›´æ–°`WEBHOOK_CONFIG.url`

### æ–¹æ¡ˆ3ï¼šä½¿ç”¨ç¬¬ä¸‰æ–¹æœåŠ¡
è€ƒè™‘ä½¿ç”¨ä»¥ä¸‹æœåŠ¡ä½œä¸ºä¸­ä»‹ï¼š
- Vercel Functions
- Netlify Functions
- Cloudflare Workers

## ğŸ”„ å½“å‰çŠ¶æ€

âœ… **å·²å®Œæˆ**ï¼š
- é”™è¯¯å¤„ç†å¢å¼º
- é‡è¯•æœºåˆ¶
- å¤‡ç”¨è”ç³»æ–¹å¼
- è°ƒè¯•å·¥å…·

â³ **å¾…éªŒè¯**ï¼š
- Webhook Keyæ˜¯å¦æœ‰æ•ˆ
- å®é™…éƒ¨ç½²ç¯å¢ƒæµ‹è¯•

## ğŸ“ ä¸´æ—¶è§£å†³æ–¹æ¡ˆ

å¦‚æœwebhookä»ç„¶æ— æ³•å·¥ä½œï¼Œç”¨æˆ·å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼è”ç³»ï¼š

- **å¾®ä¿¡**ï¼š646881507
- **ç”µè¯**ï¼š18825080358  
- **é‚®ç®±**ï¼šchen.jiantu@weiwise.cn

ç³»ç»Ÿä¼šåœ¨webhookå¤±è´¥æ—¶è‡ªåŠ¨æ˜¾ç¤ºè¿™äº›è”ç³»æ–¹å¼ã€‚
